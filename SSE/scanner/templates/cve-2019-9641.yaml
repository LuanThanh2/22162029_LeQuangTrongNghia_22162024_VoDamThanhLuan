id: CVE-2019-9641
info:
  name: PHP EXIF Deserialization Vulnerability (CVE-2019-9641)
  author: nghia
  severity: critical
  description: Detects CVE-2019-9641, an unserialize vulnerability in PHP versions 5.3.0 to 7.0.0, which can lead to remote code execution or denial of service via malicious EXIF data in TIFF images.
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9641
  tags: cve, cve2019, php, rce, deserialization
http:
  - method: GET
    path:
      - "{{BaseURL}}/product.php?pic={{randstr}}"
      - "{{BaseURL}}/showimage.php?file={{randstr}}"
    payloads:
      randstr:
        - '!a:1:{s:4:"test";O:8:"stdClass":0:{}}'
        - 'a:1:{s:4:"test";O:8:"stdClass":1:{s:3:"foo";s:3:"bar";}}'
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "Fatal error"
          - "Uncaught Exception"
          - "Call to undefined method"
        condition: or
      - type: status
        status:
          - 500
